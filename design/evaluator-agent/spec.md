# 評価エージェント仕様書

## 1. 概要

### 1.1 目的

評価対象と評価内容を受け取り、自律的に評価基準を策定し、必要に応じてインターネットで情報収集を行い、包括的な評価結果を提供するエージェント。

### 1.2 背景

- 記事の品質評価を主なユースケースとするが、他の評価対象にも柔軟に対応
- 評価基準を自動で考案し、不明点がある場合は依頼者に確認を求める

## 2. 要件

### 2.1 機能要件

#### FR-1: プロアクティブゴールクリエイター

評価を開始する前に、評価目標と基準を明確化するコンポーネント。

| ID | 要件 |
|----|------|
| FR-1.1 | 評価対象と評価内容から、具体的な評価目標を生成する |
| FR-1.2 | 評価対象の種類（記事、サービス、製品など）を判別する |
| FR-1.3 | 評価対象に適した評価基準を自動で策定する |
| FR-1.4 | 評価基準の策定が困難な場合、依頼者に質問を生成する |
| FR-1.5 | 依頼者の回答を反映して評価基準を更新する |

#### FR-2: 評価実行

| ID | 要件 |
|----|------|
| FR-2.1 | 評価基準に基づいて評価計画を立案する |
| FR-2.2 | 必要に応じてインターネット検索で情報を収集する |
| FR-2.3 | 収集した情報と評価基準を用いて評価を実行する |
| FR-2.4 | 評価の十分性を自己評価し、不十分な場合は追加調査する |

#### FR-3: 評価結果出力

| ID | 要件 |
|----|------|
| FR-3.1 | 総合スコア（0-100）を算出する |
| FR-3.2 | 評価基準ごとの個別スコアを算出する |
| FR-3.3 | 長所を具体的に列挙する |
| FR-3.4 | 短所を具体的に列挙する |
| FR-3.5 | 具体的な改善点を提案する |

### 2.2 非機能要件

| ID | 要件 |
|----|------|
| NFR-1 | 評価プロセスは最大5回のリトライで完了する |
| NFR-2 | 評価基準が不明確な場合、3つ以下の質問に絞る |
| NFR-3 | 既存の `keyword_finder` と同様のアーキテクチャを採用する |

## 3. システム設計

### 3.1 アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    Evaluator Agent                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [EvaluationInput]                                          │
│         │                                                   │
│         ▼                                                   │
│  ┌─────────────────────┐                                    │
│  │ 1. GoalCreator      │ ← 評価目標・基準を策定             │
│  │    (プロアクティブ)  │   → 不明点があれば質問を生成       │
│  └─────────────────────┘                                    │
│         │                                                   │
│         ▼                                                   │
│  ┌─────────────────────┐                                    │
│  │ 2. Planner          │ ← 評価計画を立案                   │
│  └─────────────────────┘                                    │
│         │                                                   │
│         ▼                                                   │
│  ┌─────────────────────┐                                    │
│  │ 3. Executor         │ ← 情報収集・評価実行               │
│  │    (with tools)     │   → search_web                     │
│  └─────────────────────┘                                    │
│         │                                                   │
│         ▼                                                   │
│  ┌─────────────────────┐                                    │
│  │ 4. Reflector        │ ← 評価の十分性を検証               │
│  └─────────────────────┘                                    │
│         │                                                   │
│    [十分?]─No──▶ Executor へ戻る (max 5回)                  │
│         │                                                   │
│        Yes                                                  │
│         │                                                   │
│         ▼                                                   │
│  ┌─────────────────────┐                                    │
│  │ 5. Integrator       │ ← 結果を統合・整形                 │
│  └─────────────────────┘                                    │
│         │                                                   │
│         ▼                                                   │
│  [EvaluationOutput]                                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 コンポーネント詳細

#### 3.2.1 GoalCreator（プロアクティブゴールクリエイター）

**役割**: 評価目標と評価基準の明確化

**入力**:
- `target`: 評価対象（テキスト or URL）
- `target_type`: 対象の種類（article, service, product, other）
- `evaluation_request`: 評価してほしい内容の説明

**出力**:
- `evaluation_goal`: 明確化された評価目標
- `evaluation_criteria`: 評価基準のリスト
- `questions`: 依頼者への質問（必要な場合のみ）
- `needs_clarification`: 質問が必要かどうかのフラグ

**処理ロジック**:
1. 評価対象の種類を判別
2. 対象種類に応じたデフォルト評価基準を生成
3. 評価リクエストの内容を解析
4. 不明点や曖昧な点を検出
5. 質問が必要な場合は `needs_clarification=True` で質問を生成
6. 十分な情報がある場合は評価基準を確定

#### 3.2.2 Planner

**役割**: 評価計画の立案

**入力**:
- GoalCreatorの出力
- 評価対象の詳細

**出力**:
- `evaluation_plan`: 評価ステップのリスト
- `required_research`: 必要な調査項目

#### 3.2.3 Executor

**役割**: 情報収集と評価の実行

**利用ツール**:
- `search_web`: 関連情報の検索（ベストプラクティス、比較対象など）

**処理**:
1. 計画に基づいて情報収集
2. 収集した情報を基に評価を実行
3. 各評価基準に対するスコアと根拠を記録

#### 3.2.4 Reflector

**役割**: 評価の十分性検証

**評価観点**:
- すべての評価基準がカバーされているか
- 根拠が十分に示されているか
- スコアの妥当性
- 改善点が具体的か

#### 3.2.5 Integrator

**役割**: 最終結果の統合と整形

## 4. データ構造

### 4.1 入力スキーマ

```python
class EvaluationInput:
    target: str                    # 評価対象（テキスト or URL）
    target_type: Literal["article", "service", "product", "other"]
    evaluation_request: str        # 評価してほしい内容
    context: str | None = None     # 追加コンテキスト（任意）
```

### 4.2 出力スキーマ

```python
class CriterionScore:
    criterion: str          # 評価基準名
    score: int              # スコア (0-100)
    rationale: str          # スコアの根拠

class EvaluationOutput:
    target_summary: str           # 評価対象の要約
    target_type: str              # 対象の種類
    overall_score: int            # 総合スコア (0-100)
    criterion_scores: list[CriterionScore]  # 基準別スコア
    strengths: list[str]          # 長所リスト
    weaknesses: list[str]         # 短所リスト
    improvements: list[str]       # 改善点リスト
    evaluation_criteria: list[str]  # 使用した評価基準
    summary: str                  # 評価サマリー
```

### 4.3 質問スキーマ（GoalCreator用）

```python
class ClarificationQuestion:
    question: str           # 質問内容
    options: list[str] | None  # 選択肢（あれば）
    purpose: str            # この質問の目的

class GoalCreatorOutput:
    evaluation_goal: str
    evaluation_criteria: list[str]
    questions: list[ClarificationQuestion]
    needs_clarification: bool
```

## 5. 評価基準テンプレート

### 5.1 記事評価（article）

| 基準 | 説明 |
|------|------|
| 正確性 | 情報が正確で信頼できるか |
| 網羅性 | トピックを十分にカバーしているか |
| 読みやすさ | 構成・文体が読みやすいか |
| 独自性 | オリジナルな視点や情報があるか |
| SEO最適化 | 検索エンジン最適化が適切か |
| 実用性 | 読者にとって役立つ内容か |

### 5.2 サービス評価（service）

| 基準 | 説明 |
|------|------|
| 機能性 | 提供機能が目的を満たすか |
| 使いやすさ | UIが直感的で使いやすいか |
| 信頼性 | 安定して動作するか |
| コストパフォーマンス | 価格に見合う価値があるか |
| サポート | サポート体制が充実しているか |

### 5.3 製品評価（product）

| 基準 | 説明 |
|------|------|
| 品質 | 製品の品質が高いか |
| デザイン | デザインが優れているか |
| 機能性 | 必要な機能を備えているか |
| 耐久性 | 長期間使用に耐えるか |
| コストパフォーマンス | 価格に見合う価値があるか |

## 6. 制約事項

- 評価対象がURLの場合、アクセス可能である必要がある
- インターネット検索は評価の補助情報取得に使用
- 最終的な評価判断はLLMが行う

## 7. 成功基準

1. 評価対象の種類を正しく判別できる
2. 適切な評価基準を自動生成できる
3. 不明点がある場合に的確な質問を生成できる
4. スコア、長所、短所、改善点を含む評価結果を出力できる
5. 記事以外の評価対象にも対応できる
