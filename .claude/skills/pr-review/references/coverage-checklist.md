# テストカバレッジチェックリスト

## カバレッジ目標

| レベル | カバレッジ | 対象 |
|--------|-----------|------|
| 最低限 | 80% | 全体 |
| 推奨 | 90% | 重要なビジネスロジック |
| 必須 | 100% | セキュリティ関連コード |

## カバレッジ確認コマンド

### Python (pytest)

```bash
# 基本的なカバレッジ確認
uv run pytest --cov --cov-report=term-missing

# 特定ディレクトリのカバレッジ
uv run pytest --cov=src/agents --cov-report=term-missing

# HTMLレポート生成
uv run pytest --cov --cov-report=html
```

### TypeScript (vitest)

```bash
# 基本的なカバレッジ確認
npm run test -- --coverage

# 特定ファイルのカバレッジ
npm run test -- --coverage path/to/file.test.ts
```

## 必須テストケース

### 正常系

| ケース | 説明 |
|--------|------|
| 基本動作 | 最も一般的な入力での動作 |
| 境界値 | 最小値、最大値、境界±1 |
| 空入力 | 空文字、空配列、null/None |

### 異常系

| ケース | 説明 |
|--------|------|
| 無効な入力 | 型エラー、範囲外、不正な形式 |
| 例外発生 | 期待される例外が発生するか |
| エラーメッセージ | 適切なエラーメッセージか |

### エッジケース

| ケース | 説明 |
|--------|------|
| 並行処理 | 複数リクエストの同時処理 |
| タイムアウト | 長時間処理のタイムアウト |
| リトライ | 失敗時のリトライ動作 |

## カバレッジ不足の典型パターン

### 1. 条件分岐のカバレッジ不足

```python
# カバレッジ不足の例
def process(value):
    if value > 0:
        return "positive"
    elif value < 0:
        return "negative"
    else:
        return "zero"  # ← このパスがテストされていない
```

**確認**: if/elif/else の全パスがテストされているか

### 2. 例外処理のカバレッジ不足

```python
# カバレッジ不足の例
def read_file(path):
    try:
        with open(path) as f:
            return f.read()
    except FileNotFoundError:
        return None  # ← このパスがテストされていない
```

**確認**: try/except の例外パスがテストされているか

### 3. ループのカバレッジ不足

```python
# カバレッジ不足の例
def sum_list(items):
    total = 0
    for item in items:  # ← 空リストのケースがテストされていない
        total += item
    return total
```

**確認**: 0件、1件、複数件のケースがテストされているか

### 4. 早期リターンのカバレッジ不足

```python
# カバレッジ不足の例
def validate(data):
    if not data:
        return False  # ← このパスがテストされていない
    if not data.get("name"):
        return False  # ← このパスがテストされていない
    return True
```

**確認**: 各早期リターンがテストされているか

## テスト品質チェック

### テスト構造

- [ ] **Arrange**: テストデータと依存関係が適切に準備されているか
- [ ] **Act**: テスト対象の操作が明確か
- [ ] **Assert**: 期待値の検証が適切か

### テストの独立性

- [ ] 各テストが他のテストに依存していないか
- [ ] テストの実行順序に依存していないか
- [ ] グローバル状態を汚染していないか

### モックの使用

- [ ] 外部依存（API、DB、ファイルシステム）が適切にモックされているか
- [ ] モックの戻り値が現実的か
- [ ] モックの呼び出し回数・引数が検証されているか

## レビュー時の確認事項

### 新規コード

- [ ] 新規追加されたファイルにテストファイルが存在するか
- [ ] 新規追加された関数/メソッドにテストがあるか
- [ ] 新規追加された条件分岐がテストされているか

### 変更コード

- [ ] 変更された関数のテストが更新されているか
- [ ] 変更によって既存テストが壊れていないか
- [ ] 新しい条件分岐のテストが追加されているか

### 削除コード

- [ ] 削除されたコードに対応するテストも削除されているか
- [ ] 不要になったモックが削除されているか
