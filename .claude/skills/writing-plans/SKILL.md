---
name: writing-plans
description: 複雑なタスクの実装計画を作成する。spec.md、plan.md、task.mdを順番に作成し、TDDに基づいた細かいステップに分解する。
---

# Writing Plans

複雑なタスクの実装計画を作成するスキル。TDDに基づいた細かいステップで構成される計画を作成する。

**Core principle:** 複雑な作業を小さなステップに分解する（目安: 1つのTDDサイクル、1つの関数実装、1つのテストケース）

**開始時のアナウンス:** 「writing-plansスキルを使用して実装計画を作成します。」

## When to Use

- 複数ステップが必要な新機能の実装
- 既存コードの大規模なリファクタリング
- 複数ファイルにまたがる変更
- アーキテクチャの変更

## Plan Structure

このプロジェクトでは、計画は `design/<機能名>/` ディレクトリに以下の3ファイルで構成される:

```
design/
└── <機能名>/
    ├── spec.md    # 仕様書（要件定義）
    ├── plan.md    # 実装計画
    └── task.md    # タスクリスト
```

### 1. spec.md（仕様書）

**含めるべき内容:**
- 機能の目的・背景
- 要件（機能要件・非機能要件）
- 入出力の定義
- 制約事項
- 成功基準

### 2. plan.md（実装計画）

**含めるべき内容:**
- 実装ステップの詳細
- 影響を受けるファイル・モジュール
- 依存関係
- テスト計画
- リスクと対策

### 3. task.md（タスクリスト）

**含めるべき内容:**
- 実行すべきタスクの一覧（チェックボックス形式）
- 各タスクの完了条件
- タスク間の依存関係
- 優先順位

## Task Granularity

各タスクはTDDサイクルに従って分解する:

```
1. [ ] 失敗するテストを書く
2. [ ] テストが失敗することを確認
3. [ ] 最小限の実装を書く
4. [ ] テストが通ることを確認
5. [ ] コミット
```

**良いタスクの例:**
```markdown
## Task 1: ユーザー入力のバリデーション

### 1.1 メールアドレスのバリデーション
- [ ] 無効なメールアドレスを拒否するテストを書く
- [ ] テストが失敗することを確認
- [ ] validate_email関数を実装
- [ ] テストが通ることを確認
- [ ] コミット: "feat: add email validation"
```

## Documentation Requirements

計画には以下を含める:

- **正確なファイルパス**: `src/utils/validation.py` のように完全パスで記述
- **コードサンプル**: 必要に応じて実装例を含める
- **コマンドと期待出力**: `pytest tests/ -v` → "5 passed"
- **相互参照**: 関連するspec.mdやplan.mdへのリンク

## The Process

```
1. 要件を理解する
   |
   v
2. spec.md を作成
   - 目的・背景を明確化
   - 要件を列挙
   - 成功基準を定義
   |
   v
3. plan.md を作成
   - アーキテクチャを決定
   - 実装ステップを設計
   - リスクを特定
   |
   v
4. task.md を作成
   - タスクをTDDステップに分解
   - 依存関係を整理
   - チェックボックス形式で記述
   |
   v
5. spec.md と task.md を照合
   - すべての要件がカバーされているか確認
   - 不足があれば追加
   |
   v
6. 実行方法を提案
   - subagent-driven-development で実行
   - または手動で実行
```

## Execution Handoff

計画完了後、以下の選択肢を提示:

1. **subagent-driven-development で実行** - 推奨
   - タスクごとにサブエージェントを起動
   - 2段階レビュー（仕様準拠 → コード品質）
   - コンテキスト汚染を防止

2. **手動で実行**
   - task.md のチェックリストに従って実装
   - 自分のペースで進められる

## Integration

**連携するスキル:**
- **subagent-driven-development** - この計画を実行する
- **pr-review** - 実装後のコードレビュー
- **finishing-a-development-branch** - 開発完了後の処理

## Example

```markdown
# design/user-auth/spec.md

## 目的
ユーザー認証機能を追加する

## 要件
- メールアドレスとパスワードでログイン
- JWTトークンを発行
- トークンの有効期限は24時間

## 成功基準
- [ ] ログインAPIが正常に動作する
- [ ] 無効な認証情報で401エラーを返す
- [ ] トークンの検証が正しく動作する
```

```markdown
# design/user-auth/task.md

## Task 1: ログインエンドポイント

### 1.1 認証失敗のテスト
- [ ] 無効な認証情報で401を返すテストを書く
- [ ] テストが失敗することを確認
- [ ] login関数を実装
- [ ] テストが通ることを確認
- [ ] コミット

### 1.2 認証成功のテスト
- [ ] 有効な認証情報でトークンを返すテストを書く
...
```

## Red Flags

**Never:**
- 曖昧なタスク説明（「認証を実装する」→ 具体的なステップに分解）
- テストなしの実装ステップ
- 5分以上かかるタスク（分割が必要）
- spec.md なしで plan.md を作成

**Always:**
- 各タスクに完了条件を含める
- TDDサイクルに従う
- コミットポイントを明示する
